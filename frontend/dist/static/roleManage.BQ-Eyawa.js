import{k as e,m as a,n as l,o as t,l as s,j as o,b as r}from"./index.CmK67jVc.js";import{a as i,E as n}from"./element-plus.BU70F6Fx.js";import{r as d,b as u,al as p,K as m,o as c,L as h,T as f,u as v,O as b,l as g,Q as y,d as j,j as w,e as k,ar as x,c as _,H as C,M as V,a as S,G as q,n as O}from"./@vue.CTPu-uAZ.js";import{l as B}from"./lySearchBar.BXPoi329.js";import{a as E,u as U}from"./vue-router.kfYy4LLd.js";import"./axios.DpIj8wd6.js";import"./crypto-js.CDMBIImi.js";import"./clipboard.DkQLcScs.js";import"./js-cookie.Ch5AnFJE.js";import"./pinia.zQpyPaWK.js";import"./@element-plus.DmP6zw14.js";import"./xe-utils.D2X37hqE.js";import"./sortablejs.C7MwSjUq.js";import"./vue-i18n.Diqqvor5.js";import"./@intlify.CzB25nlE.js";import"./file-saver.B7Ix4MNR.js";import"./lodash-es.inYd2OMh.js";import"./pinia-plugin-persistedstate.C_byIVBZ.js";import"./destr.WfmzGWA8.js";import"./deep-pick-omit.CDZeMyKV.js";import"./nprogress.CyzJYN2f.js";import"./@tsparticles.Csp0zpCD.js";import"./@vueuse.CxA-JytG.js";import"./@popperjs.CT_jBSb5.js";import"./@ctrl.D-8vaqgC.js";import"./dayjs.Gu-B5VJn.js";import"./async-validator.j0i5Y79Y.js";import"./memoize-one.BAtLgO95.js";import"./normalize-wheel-es.BhHBPXsK.js";import"./@floating-ui.CzXNizXq.js";const D={};function M(e={}){return{crudOptions:{request:{add:D.add,del:D.del,edit:D.edit,list:D.list,export:null,detail:null,import:null,setStatus:D.setStatus,...e.request||{}},searchBar:{showSearchBar:!0,...e.searchBar||{}},pagination:{hidePagination:!1,...e.pagination||{}},rowHandle:{width:190,fixed:"right",...e.rowHandle||{}},table:{tableName:"roleManageTable",pageSize:10,rowKey:"id",lazy:!1,isTree:!1,treeProps:{children:"children",hasChildren:"hasChildren"},border:!0,defaultExpandAll:!0,showSelectable:!0,hideImport:!0,hideExport:!1,...e.table||{}},columns:e.columns||[{label:"\u89d2\u8272\u540d\u79f0",prop:"name",minWidth:"110"},{label:"\u6743\u9650\u5b57\u7b26",prop:"key",minWidth:"110"},{label:"\u72b6\u6001",prop:"status",width:"100"},{label:"\u6392\u5e8f",prop:"sort",width:"100"},{label:"\u521b\u5efa\u65f6\u95f4",prop:"create_datetime",minWidth:"180"}]}}}D.list=a=>e({url:"/api/system/role/",params:a}),D.add=e=>a({url:"/api/system/role/",params:e}),D.edit=e=>l({url:"/api/system/role/",params:e}),D.del=e=>t({url:"/api/system/role/",params:e}),D.setStatus=e=>a({url:"/api/system/role/set_status/",params:e});const z={__name:"moduleSave",emits:["refreshData","closed"],setup(e,{expose:a,emit:l}){const t=l;let r=d(M().crudOptions),j=d("add");const w={add:"\u65b0\u589e",edit:"\u7f16\u8f91",detail:"\u67e5\u770b"};let k=d(!1),x=d(!1),_=d(null),C=d({key:"",name:"",sort:1,status:!0}),V={sort:[{required:!0,message:"\u8bf7\u8f93\u5165\u6392\u5e8f",trigger:"change"}],name:[{required:!0,message:"\u8bf7\u8f93\u5165\u89d2\u8272\u540d\u79f0"}],key:[{required:!0,message:"\u8bf7\u8f93\u5165\u6743\u9650\u5b57\u7b26"}]};return u(()=>{}),a({handleOpen:(e=null,a="add")=>{j.value=a,k.value=!0,e&&(C.value=o(e))}}),(e,a)=>{const l=p("el-input"),o=p("el-form-item"),d=p("el-input-number"),u=p("el-switch"),S=p("el-form"),q=p("el-button");return c(),m(s,{title:w[v(j)],modelValue:v(k),"onUpdate:modelValue":a[6]||(a[6]=e=>g(k)?k.value=e:k=e),width:"500px","destroy-on-close":"",onClosed:a[7]||(a[7]=e=>t("closed"))},{footer:h(()=>[f(q,{onClick:a[4]||(a[4]=e=>g(k)?k.value=!1:k=!1)},{default:h(()=>[...a[8]||(a[8]=[y("\u53d6 \u6d88",-1)])]),_:1}),"detail"!=v(j)?(c(),m(q,{key:0,type:"primary",loading:v(x),onClick:a[5]||(a[5]=e=>{_.value.validate(async e=>{if(e){x.value=!0;let e=r.value.request.add;"edit"==j.value&&(e=r.value.request.edit);const a=await e(C.value);x.value=!1,2e3==a.code?(t("refreshData"),k.value=!1,i.success("\u64cd\u4f5c\u6210\u529f")):n.alert(a.msg,"\u63d0\u793a",{type:"error"})}})})},{default:h(()=>[...a[9]||(a[9]=[y("\u4fdd \u5b58",-1)])]),_:1},8,["loading"])):b("",!0)]),default:h(()=>[f(S,{model:v(C),rules:v(V),disabled:"detail"==v(j),ref_key:"dialogForm",ref:_,"label-width":"auto"},{default:h(()=>[f(o,{label:"\u89d2\u8272\u540d\u79f0",prop:"name"},{default:h(()=>[f(l,{modelValue:v(C).name,"onUpdate:modelValue":a[0]||(a[0]=e=>v(C).name=e),placeholder:"\u8bf7\u8f93\u5165\u89d2\u8272\u540d\u79f0",clearable:""},null,8,["modelValue"])]),_:1}),f(o,{label:"\u6743\u9650\u5b57\u7b26",prop:"key"},{default:h(()=>[f(l,{modelValue:v(C).key,"onUpdate:modelValue":a[1]||(a[1]=e=>v(C).key=e),placeholder:"\u8bf7\u8f93\u5165\u6743\u9650\u6807\u8bc6\uff0c\u5982\uff1aadmin",clearable:""},null,8,["modelValue"])]),_:1}),f(o,{label:"\u6392\u5e8f",prop:"sort"},{default:h(()=>[f(d,{modelValue:v(C).sort,"onUpdate:modelValue":a[2]||(a[2]=e=>v(C).sort=e),"controls-position":"right",min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),f(o,{label:"\u72b6\u6001",prop:"status"},{default:h(()=>[f(u,{modelValue:v(C).status,"onUpdate:modelValue":a[3]||(a[3]=e=>v(C).status=e),"inline-prompt":"","active-text":"\u542f\u7528","inactive-text":"\u7981\u7528"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules","disabled"])]),_:1},8,["title","modelValue"])}}},H={style:{display:"flex","justify-content":"space-between","align-items":"center"}},T=["onClick"],I=["onClick"],P=["onClick"],R=j({name:"roleManage"}),W=Object.assign(R,{setup(e){const a=E(),l=U(),t=r();let s=d(M().crudOptions);const o=e=>t.hasButtonPermission(a.name,e),g=d(!1),j=d(!1),D=d({}),R=d(null),W=d(null),K=d(null);let A=d([]);function F(e){A.value=e}let G=w(()=>({...s.value.table,...s.value.pagination,apiObj:s.value.request.list,apiExportObj:s.value.request.export,params:D.value,column:s.value.columns,hideExport:!o("Export"),hideImport:!o("Import")}));const L=()=>{g.value=!g.value,window.dispatchEvent(new Event("resize"))},N=()=>{j.value=!0,O(()=>{K.value.handleOpen(null,"add")})};function Q(){n.confirm(`\u786e\u5b9a\u5220\u9664\u9009\u4e2d\u7684 ${A.value.length} \u9879\u5417\uff1f`,"\u63d0\u793a",{confirmButtonText:"\u786e\u5b9a",cancelButtonText:"\u53d6\u6d88",type:"warning"}).then(()=>{let e=A.value.map(e=>e.id);s.value.request.del({id:e}).then(e=>{2e3==e.code?(J(),i.success("\u64cd\u4f5c\u6210\u529f")):i.warning(e.msg)})}).catch(()=>{})}const $=(e,a)=>{switch(a){case"edit":j.value=!0,O(()=>{K.value.handleOpen(e,"edit")});break;case"delete":n.confirm("\u60a8\u786e\u5b9a\u8981\u5220\u9664\u9009\u4e2d\u7684\u6570\u636e\u5417\uff1f","\u8b66\u544a",{closeOnClickModal:!1,type:"warning"}).then(()=>{s.value.request.del({id:e.id}).then(e=>{2e3==e.code?(i.success(e.msg),J()):i.warning(e.msg)})}).catch(()=>{});break;case"gosq":l.push({name:"authorityManage",state:{id:e.id}});case"reset":D.value={},J()}},J=()=>{W.value.reload(D.value)},X=()=>{W.value.getData()};return u(()=>{}),k(()=>{}),(e,a)=>{const l=p("el-input"),t=p("el-form-item"),r=p("el-card"),d=p("el-button"),u=p("el-switch"),w=p("full-screen"),k=p("el-icon"),O=p("el-tooltip"),E=p("el-table-column"),U=p("ly-table"),M=x("auth");return c(),_("div",{class:q([{"ly-is-full":g.value},"lycontainer"])},[v(s).searchBar.showSearchBar?(c(),m(r,{key:0,class:"tableSelect",ref_key:"tableSelect",ref:R,shadow:"hover"},{default:h(()=>[f(B,{model:D.value,onSearch:J,onReset:a[1]||(a[1]=e=>$("","reset"))},{default:h(()=>[f(t,{label:"\u89d2\u8272\u540d\u79f0"},{default:h(()=>[f(l,{modelValue:D.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>D.value.name=e),modelModifiers:{trim:!0},maxlength:"60",clearable:"",style:{width:"160px"},placeholder:"\u89d2\u8272\u540d\u79f0"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},512)):b("",!0),f(r,{class:"lytable",shadow:"hover"},{default:h(()=>[f(U,C(v(G),{ref_key:"tableref",ref:W,onSelectionChange:F}),{topbar:h(()=>[V((c(),m(d,{type:"primary",icon:"plus",onClick:N},{default:h(()=>[...a[3]||(a[3]=[y("\u65b0\u589e",-1)])]),_:1})),[[M,"Create"]]),V(f(d,{type:"danger",plain:"",icon:"delete",disabled:0==v(A).length,title:"\u6279\u91cf\u5220\u9664",onClick:Q},null,8,["disabled"]),[[M,"Delete"]])]),status:h(e=>[f(u,{modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-color":"#13ce66","inactive-color":"#ff4949",onChange:a=>(e=>{let a=e.status;e.status=!e.status,n.confirm("\u786e\u5b9a\u4fee\u6539\u72b6\u6001\u5417\uff1f","\u63d0\u9192",{closeOnClickModal:!1,type:"warning"}).then(()=>{s.value.request.setStatus({id:e.id}).then(l=>{2e3==l.code?(e.status=!!a,i.success(l.msg),X()):i.warning(l.msg)})})})(e.row),disabled:!o("SetStatus")},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"])]),default:h(()=>[f(E,{label:"\u64cd\u4f5c",fixed:v(s).rowHandle.fixed,width:v(s).rowHandle.width},{header:h(()=>[S("div",H,[a[4]||(a[4]=S("div",null,"\u64cd\u4f5c",-1)),S("div",{onClick:L},[f(O,{content:"\u5168\u5c4f",placement:"bottom"},{default:h(()=>[f(k,{style:{cursor:"pointer"}},{default:h(()=>[f(w)]),_:1})]),_:1})])])]),default:h(e=>[V((c(),_("span",{class:"table-operate-btn",onClick:a=>$(e.row,"edit")},[...a[5]||(a[5]=[y("\u7f16\u8f91",-1)])],8,T)),[[M,"Update"]]),V((c(),_("span",{class:"table-operate-btn delete",onClick:a=>$(e.row,"delete")},[...a[6]||(a[6]=[y("\u5220\u9664",-1)])],8,I)),[[M,"Delete"]]),S("span",{class:"table-operate-btn warning",onClick:a=>$(e.row,"gosq")},"\u6743\u9650\u914d\u7f6e",8,P)]),_:1},8,["fixed","width"])]),_:1},16)]),_:1}),j.value?(c(),m(z,{key:1,ref_key:"saveDialogRef",ref:K,onRefreshData:X,onClosed:a[2]||(a[2]=e=>j.value=!1)},null,512)):b("",!0)],2)}}});export{W as default};
