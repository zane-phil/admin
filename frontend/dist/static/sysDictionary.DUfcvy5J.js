import{r as e,m as l,al as a,K as t,o,L as s,T as i,Q as r,c as n,S as u,a7 as d,n as c,d as m,j as p,k as v,b as f,ar as y,O as g,a as b,u as h,M as _,R as w,X as V,F as j,l as k,G as x}from"./@vue.CTPu-uAZ.js";import{a as C}from"./vue-router.kfYy4LLd.js";import{u as D}from"./@vueuse.CxA-JytG.js";import{M as U,T as M,P as F,B as R}from"./@element-plus.DmP6zw14.js";import{_ as T,l as q,j as I,A as O}from"./index.CmK67jVc.js";import{a as z,E as B}from"./element-plus.BU70F6Fx.js";import"./axios.DpIj8wd6.js";import"./crypto-js.CDMBIImi.js";import"./clipboard.DkQLcScs.js";import"./js-cookie.Ch5AnFJE.js";import"./pinia.zQpyPaWK.js";import"./xe-utils.D2X37hqE.js";import"./sortablejs.C7MwSjUq.js";import"./vue-i18n.Diqqvor5.js";import"./@intlify.CzB25nlE.js";import"./file-saver.B7Ix4MNR.js";import"./lodash-es.inYd2OMh.js";import"./pinia-plugin-persistedstate.C_byIVBZ.js";import"./destr.WfmzGWA8.js";import"./deep-pick-omit.CDZeMyKV.js";import"./nprogress.CyzJYN2f.js";import"./@tsparticles.Csp0zpCD.js";import"./@popperjs.CT_jBSb5.js";import"./@ctrl.D-8vaqgC.js";import"./dayjs.Gu-B5VJn.js";import"./async-validator.j0i5Y79Y.js";import"./memoize-one.BAtLgO95.js";import"./normalize-wheel-es.BhHBPXsK.js";import"./@floating-ui.CzXNizXq.js";const E=T({__name:"sysDicModule",emits:["refreshData"],setup(n,{expose:u,emit:d}){const c=d,m=e(!1),p=e(!1),v=e(""),f=e(null),y=l({label:"",value:"",sort:1,remark:""}),g=l({label:[{required:!0,message:"\u8bf7\u8f93\u5165\u540d\u79f0",trigger:"blur"}],value:[{required:!0,message:"\u8bf7\u8f93\u5165key\u503c",trigger:"blur"}]}),b=()=>{Object.assign(y,{label:"",value:"",sort:1,remark:""})},h=()=>{b(),m.value=!1},_=async()=>{try{if(!(await f.value.validate()))return;p.value=!0;const e={...y},l=y.id?O.systemDictionaryEdit:O.systemDictionaryAdd,a=await l(e);2e3===a.code?(z.success(a.msg),c("refreshData"),h()):z.warning(a.msg)}catch(e){}finally{p.value=!1}};return u({addModuleFn:(e,l)=>{m.value=!0,v.value=l,e?Object.assign(y,I(e)):b()}}),(e,l)=>{const n=a("el-input"),u=a("el-form-item"),d=a("el-input-number"),c=a("el-form"),b=a("el-button");return o(),t(q,{modelValue:m.value,"onUpdate:modelValue":l[4]||(l[4]=e=>m.value=e),title:v.value,width:"640px","before-close":h},{footer:s(()=>[i(b,{onClick:h,loading:p.value},{default:s(()=>[...l[5]||(l[5]=[r("\u5173\u95ed",-1)])]),_:1},8,["loading"]),i(b,{type:"primary",onClick:_,loading:p.value},{default:s(()=>[...l[6]||(l[6]=[r("\u4fdd\u5b58",-1)])]),_:1},8,["loading"])]),default:s(()=>[i(c,{inline:!1,model:y,rules:g,ref_key:"formRef",ref:f,"label-position":"right","label-width":"auto"},{default:s(()=>[i(u,{label:"\u5b57\u5178\u540d\u79f0",prop:"label"},{default:s(()=>[i(n,{modelValue:y.label,"onUpdate:modelValue":l[0]||(l[0]=e=>y.label=e),modelModifiers:{trim:!0},placeholder:"\u5b57\u5178\u540d\u79f0"},null,8,["modelValue"])]),_:1}),i(u,{label:"\u5b57\u5178\u7f16\u53f7",prop:"value"},{default:s(()=>[i(n,{modelValue:y.value,"onUpdate:modelValue":l[1]||(l[1]=e=>y.value=e),modelModifiers:{trim:!0},placeholder:"\u5b57\u5178\u7f16\u53f7"},null,8,["modelValue"])]),_:1}),i(u,{label:"\u6392\u5e8f",prop:"sort"},{default:s(()=>[i(d,{modelValue:y.sort,"onUpdate:modelValue":l[2]||(l[2]=e=>y.sort=e),min:0,max:9999},null,8,["modelValue"])]),_:1}),i(u,{label:"\u5907\u6ce8",prop:"remark"},{default:s(()=>[i(n,{type:"textarea",rows:2,modelValue:y.remark,"onUpdate:modelValue":l[3]||(l[3]=e=>y.remark=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}},[["__scopeId","data-v-19ea75e5"]]),L=T({__name:"sysDicListModule",emits:["refreshData"],setup(m,{expose:p,emit:v}){const f=v,y=e(!1),g=e(!1),b=e(""),h=e(null),_=l({parent:"",label:"",value:"",sort:1,status:!0,remark:""}),w=l({parent:[{required:!0,message:"\u8bf7\u9009\u62e9\u6240\u5c5e\u5b57\u5178",trigger:"blur"}],label:[{required:!0,message:"\u8bf7\u8f93\u5165\u9879\u540d\u79f0",trigger:"blur"}],value:[{required:!0,message:"\u8bf7\u8f93\u5165\u6570\u636e\u503c",trigger:"blur"}]}),V=e([]),j=async()=>{try{const e=await O.systemDictionary({parent_isnull:!0,page:1,limit:999});2e3===e.code&&(V.value=e.data.data)}catch(e){}},k=()=>{Object.assign(_,{parent:"",label:"",value:"",sort:1,status:!0,remark:""}),y.value=!1},x=async()=>{try{if(!(await h.value.validate()))return;g.value=!0;const e={..._,status:_.status?"1":"0"},l=_.id?O.systemDictionaryEdit:O.systemDictionaryAdd,a=await l(e);2e3===a.code?(z.success(a.msg),f("refreshData",_.parent),k()):z.warning(a.msg)}catch(e){}finally{g.value=!1}};return p({addModuleFn:async(e,l,a)=>{y.value=!0,b.value=l,await j(),e?(Object.assign(_,I(e)),_.status=!!e.status):_.parent=a,c(()=>{h.value&&h.value.clearValidate()})}}),(e,l)=>{const c=a("el-option"),m=a("el-select"),p=a("el-form-item"),v=a("el-input"),f=a("el-switch"),j=a("el-input-number"),C=a("el-form"),D=a("el-button");return o(),t(q,{modelValue:y.value,"onUpdate:modelValue":l[6]||(l[6]=e=>y.value=e),title:b.value,width:"640px","before-close":k},{footer:s(()=>[i(D,{onClick:k,loading:g.value},{default:s(()=>[...l[7]||(l[7]=[r("\u5173\u95ed",-1)])]),_:1},8,["loading"]),i(D,{type:"primary",onClick:x,loading:g.value},{default:s(()=>[...l[8]||(l[8]=[r("\u4fdd\u5b58",-1)])]),_:1},8,["loading"])]),default:s(()=>[i(C,{inline:!1,model:_,rules:w,ref_key:"formRef",ref:h,"label-position":"right","label-width":"auto"},{default:s(()=>[i(p,{label:"\u6240\u5c5e\u5b57\u5178\uff1a",prop:"parent"},{default:s(()=>[i(m,{modelValue:_.parent,"onUpdate:modelValue":l[0]||(l[0]=e=>_.parent=e),placeholder:"\u8bf7\u9009\u62e9",clearable:"",filterable:"",style:{width:"100%"}},{default:s(()=>[(o(!0),n(u,null,d(V.value,e=>(o(),t(c,{key:e.id,label:e.label,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(p,{label:"\u9879\u540d\u79f0",prop:"label"},{default:s(()=>[i(v,{modelValue:_.label,"onUpdate:modelValue":l[1]||(l[1]=e=>_.label=e),clearable:""},null,8,["modelValue"])]),_:1}),i(p,{label:"\u6570\u636e\u503c",prop:"value"},{default:s(()=>[i(v,{modelValue:_.value,"onUpdate:modelValue":l[2]||(l[2]=e=>_.value=e),clearable:""},null,8,["modelValue"])]),_:1}),i(p,{label:"\u662f\u5426\u6709\u6548",prop:"status"},{default:s(()=>[i(f,{modelValue:_.status,"onUpdate:modelValue":l[3]||(l[3]=e=>_.status=e)},null,8,["modelValue"])]),_:1}),i(p,{label:"\u6392\u5e8f\uff1a",prop:"sort"},{default:s(()=>[i(j,{modelValue:_.sort,"onUpdate:modelValue":l[4]||(l[4]=e=>_.sort=e),min:0,max:9999},null,8,["modelValue"])]),_:1}),i(p,{label:"\u5907\u6ce8\uff1a",prop:"remark"},{default:s(()=>[i(v,{type:"textarea",rows:2,modelValue:_.remark,"onUpdate:modelValue":l[5]||(l[5]=e=>_.remark=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}},[["__scopeId","data-v-9c6e1b8e"]]),S={class:"panel-header"},A={class:"tree-node"},K={class:"node-label"},$={class:"node-value"},G={class:"node-actions"},N={class:"panel-header"},P={class:"action-buttons"},Q={class:"lyflexcenter"},X=m({name:"sysDictionary"}),H=T(Object.assign(X,{setup(l){C();const{width:u}=D(),d=e(null),m=e(null),T=e(null),q=e(null),I=e(!1),X=e(""),H=e(!1),J=e(!1),W=e([]),Y=e([]),Z=e(null),ee=e([]),le=e(!1);let ae=e(!1),te=e(!1);const oe=p(()=>u.value<768),se={label:"label",children:"children"};v(X,e=>{d.value.filter(e)}),f(()=>{re(),oe.value||(le.value=!0)});const ie=(e,l)=>{if(!e)return!0;const a=e.toLowerCase();return l.label.toLowerCase().includes(a)||l.value&&l.value.toString().toLowerCase().includes(a)},re=async()=>{try{H.value=!0;const e=await O.systemDictionary({parent_isnull:!0,page:1,limit:999});2e3===e.code&&(W.value=e.data.data,W.value.length>0&&c(()=>{d.value.setCurrentKey(W.value[0].id),ue(W.value[0])}))}catch(e){}finally{H.value=!1}},ne=async e=>{if(e)try{J.value=!0;const l=await O.systemDictionary({parent:e,page:1,limit:999});2e3===l.code&&(Y.value=l.data.data.map(e=>({...e,loading:!1})))}catch(l){}finally{J.value=!1}},ue=e=>{Z.value=e,ne(e.id),oe.value&&(le.value=!0)},de=()=>{te.value=!0,c(()=>{T.value.addModuleFn(null,"\u65b0\u589e")})},ce=()=>{Z.value&&(ae.value=!0,c(()=>{q.value.addModuleFn(null,"\u65b0\u589e",Z.value.id)}))},me=async()=>{try{await B.confirm(`\u786e\u8ba4\u5220\u9664\u9009\u4e2d\u7684${ee.value.length}\u9879?`,"\u63d0\u793a",{confirmButtonText:"\u786e\u8ba4",cancelButtonText:"\u53d6\u6d88",type:"warning"});const e=await O.systemDictionaryDelete({id:ee.value.map(e=>e.id)});2e3===e.code?(z.success(e.msg),ee.value.forEach(e=>{const l=Y.value.findIndex(l=>l.id===e.id);-1!==l&&Y.value.splice(l,1)}),ee.value=[]):z.error(e.msg)}catch(e){"cancel"!==e&&z.error("\u5220\u9664\u5931\u8d25")}},pe=e=>{ee.value=e};return(e,l)=>{const u=a("el-input"),p=a("el-button"),v=a("el-tree"),f=a("el-scrollbar"),C=a("el-main"),D=a("el-container"),ve=a("el-aside"),fe=a("el-table-column"),ye=a("el-switch"),ge=a("el-popconfirm"),be=a("el-table"),he=y("auth"),_e=y("loading");return o(),n("div",{class:x(["dict-container",{"full-screen":I.value}])},[i(D,{class:"main-container"},{default:s(()=>[i(ve,{width:oe.value?"100%":"300px",class:"tree-panel"},{default:s(()=>[i(D,{class:"tree-container"},{default:s(()=>[b("div",S,[i(u,{modelValue:X.value,"onUpdate:modelValue":l[0]||(l[0]=e=>X.value=e),placeholder:"\u8f93\u5165\u5173\u952e\u5b57\u8fc7\u6ee4...",clearable:"","suffix-icon":h(U)},null,8,["modelValue","suffix-icon"])]),i(C,{class:"no-padding"},{default:s(()=>[i(f,null,{default:s(()=>[_((o(),t(v,{ref_key:"treeRef",ref:d,"node-key":"id",class:"leftTreeMenu",data:W.value,props:se,"filter-node-method":ie,"highlight-current":!0,"expand-on-click-node":!1,onNodeClick:ue},{default:s(({node:e,data:l})=>[b("div",A,[b("span",K,w(e.label),1),b("span",$,w(l.value),1),b("div",G,[_(i(p,{icon:h(M),size:"small",text:"",onClick:V(e=>(e=>{T.value.addModuleFn(e,"\u7f16\u8f91")})(l),["stop"]),type:"primary"},null,8,["icon","onClick"]),[[he,"Update"]]),_(i(p,{icon:h(F),size:"small",text:"",onClick:V(a=>(async(e,l)=>{try{await B.confirm(`\u786e\u8ba4\u5220\u9664\u5b57\u5178\u5206\u7c7b"${l.label}"?`,"\u63d0\u793a",{confirmButtonText:"\u786e\u8ba4",cancelButtonText:"\u53d6\u6d88",type:"warning"});const a=await O.systemDictionaryDelete({id:l.id});if(2e3===a.code){z.success(a.msg);const t=e.parent,o=t.data.children||t.data,s=o.findIndex(e=>e.id===l.id);o.splice(s,1),Z.value?.id===l.id&&(W.value.length>0?(d.value.setCurrentKey(W.value[0].id),ue(W.value[0])):(Z.value=null,Y.value=[]))}else z.error(a.msg)}catch(a){"cancel"!==a&&z.error("\u5220\u9664\u5931\u8d25")}})(e,l),["stop"]),type:"danger",style:{"margin-left":"0px"}},null,8,["icon","onClick"]),[[he,"Delete"]])])])]),_:1},8,["data"])),[[_e,H.value]])]),_:1})]),_:1})]),_:1})]),_:1},8,["width"]),i(D,{class:"content-container",style:j({display:oe.value&&!le.value?"none":"flex"})},{default:s(()=>[b("div",N,[b("div",P,[_((o(),t(p,{type:"primary",icon:h(R),onClick:de},{default:s(()=>[r(w(oe.value?"":"\u65b0\u589e\u5206\u7c7b"),1)]),_:1},8,["icon"])),[[he,"Create"]]),_((o(),t(p,{type:"warning",icon:h(R),onClick:ce,disabled:!Z.value},{default:s(()=>[r(w(oe.value?"":"\u65b0\u589e\u9879"),1)]),_:1},8,["icon","disabled"])),[[he,"Create"]]),_((o(),t(p,{type:"danger",plain:"",icon:h(F),disabled:0===ee.value.length,onClick:me},{default:s(()=>[r(w(oe.value?"":"\u5220\u9664"),1)]),_:1},8,["icon","disabled"])),[[he,"Delete"]])])]),i(C,{class:"no-padding"},{default:s(()=>[_((o(),t(be,{ref_key:"tableRef",ref:m,data:Y.value,"row-key":"id",onSelectionChange:pe,stripe:""},{default:s(()=>[i(fe,{type:"selection",width:"45"}),i(fe,{type:"index",width:"60",align:"center",label:"\u5e8f\u53f7"}),i(fe,{prop:"label",label:"\u540d\u79f0","min-width":"150",sortable:""}),i(fe,{prop:"value",label:"\u952e\u503c","min-width":"150",sortable:""}),i(fe,{prop:"status",label:"\u72b6\u6001",width:"120",align:"center"},{default:s(({row:e})=>[i(ye,{modelValue:e.status,"onUpdate:modelValue":l=>e.status=l,onChange:l=>(async e=>{try{e.loading=!0;const l=await O.systemDictionarySetStatus({id:e.id,status:e.status});2e3!==l.code?(e.status=!e.status,z.warning(l.msg)):z.success("\u8bbe\u7f6e\u6210\u529f")}catch(l){e.status=!e.status,z.error("\u72b6\u6001\u66f4\u65b0\u5931\u8d25")}finally{e.loading=!1}})(e),loading:e.loading},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),_:1}),i(fe,{prop:"sort",label:"\u6392\u5e8f",width:"100",sortable:""}),i(fe,{prop:"remark",label:"\u5907\u6ce8","min-width":"180","show-overflow-tooltip":""}),i(fe,{label:"\u64cd\u4f5c",fixed:"right",width:"140",align:"center"},{default:s(({row:e})=>[b("div",Q,[_(i(p,{icon:h(M),type:"primary",text:"",onClick:l=>(e=>{ae.value=!0,c(()=>{q.value.addModuleFn(e,"\u7f16\u8f91",Z.value.id)})})(e)},null,8,["icon","onClick"]),[[he,"Update"]]),_((o(),n("div",null,[i(ge,{title:"\u786e\u8ba4\u5220\u9664\uff1f",onConfirm:l=>(async e=>{try{const l=await O.systemDictionaryDelete({id:e.id});if(2e3===l.code){z.success(l.msg);const a=Y.value.findIndex(l=>l.id===e.id);-1!==a&&Y.value.splice(a,1)}else z.error(l.msg)}catch(l){z.error("\u5220\u9664\u5931\u8d25")}})(e)},{reference:s(()=>[i(p,{icon:h(F),text:"",type:"danger"},null,8,["icon"])]),_:2},1032,["onConfirm"])])),[[he,"Delete"]])])]),_:1})]),_:1},8,["data"])),[[_e,J.value]])]),_:1})]),_:1},8,["style"])]),_:1}),h(te)?(o(),t(E,{key:0,ref_key:"categoryDialog",ref:T,onRefreshData:re,onClosed:l[1]||(l[1]=e=>k(te)?te.value=!1:te=!1)},null,512)):g("",!0),h(ae)?(o(),t(L,{key:1,ref_key:"itemDialog",ref:q,onRefreshData:ne,onClosed:l[2]||(l[2]=e=>k(ae)?ae.value=!1:ae=!1)},null,512)):g("",!0)],2)}}}),[["__scopeId","data-v-9d7926b1"]]);export{H as default};
