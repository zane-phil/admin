import{k as e,m as a,n as l,o as t,p as s,q as o,r,l as i,j as d,b as n}from"./index.CmK67jVc.js";import{X as u}from"./xe-utils.D2X37hqE.js";import{a as p,E as m}from"./element-plus.BU70F6Fx.js";import{r as c,b as h,al as f,K as v,o as b,L as y,T as w,u as g,Q as j,R as _,O as k,l as x,d as V,j as C,e as q,ar as S,c as O,H as U,M as B,a as E,G as T,n as D}from"./@vue.CTPu-uAZ.js";import{l as z}from"./lySearchBar.BXPoi329.js";import{a as M}from"./vue-router.kfYy4LLd.js";import"./axios.DpIj8wd6.js";import"./crypto-js.CDMBIImi.js";import"./clipboard.DkQLcScs.js";import"./js-cookie.Ch5AnFJE.js";import"./pinia.zQpyPaWK.js";import"./@element-plus.DmP6zw14.js";import"./sortablejs.C7MwSjUq.js";import"./vue-i18n.Diqqvor5.js";import"./@intlify.CzB25nlE.js";import"./file-saver.B7Ix4MNR.js";import"./lodash-es.inYd2OMh.js";import"./pinia-plugin-persistedstate.C_byIVBZ.js";import"./destr.WfmzGWA8.js";import"./deep-pick-omit.CDZeMyKV.js";import"./nprogress.CyzJYN2f.js";import"./@tsparticles.Csp0zpCD.js";import"./@vueuse.CxA-JytG.js";import"./@popperjs.CT_jBSb5.js";import"./@ctrl.D-8vaqgC.js";import"./dayjs.Gu-B5VJn.js";import"./async-validator.j0i5Y79Y.js";import"./memoize-one.BAtLgO95.js";import"./normalize-wheel-es.BhHBPXsK.js";import"./@floating-ui.CzXNizXq.js";const H={};function I(e={}){return{crudOptions:{request:{add:H.add,del:H.del,edit:H.edit,list:H.list,export:H.export,detail:null,import:H.import,dltemplate:H.downloadTemplate,setStatus:H.setStatus,...e.request||{}},searchBar:{showSearchBar:!0,...e.searchBar||{}},pagination:{hidePagination:!0,...e.pagination||{}},rowHandle:{width:150,fixed:"right",...e.rowHandle||{}},table:{tableName:"deptManageTable",pageSize:999,rowKey:"id",lazy:!1,isTree:!0,treeProps:{children:"children",hasChildren:"hasChildren"},border:!0,defaultExpandAll:!0,showSelectable:!0,hideImport:!0,hideExport:!1,...e.table||{}},columns:e.columns||[{label:"\u90e8\u95e8\u540d\u79f0",prop:"name",minWidth:"130"},{label:"\u6807\u8bc6\u5b57\u7b26",prop:"key",minWidth:"100"},{label:"\u8d1f\u8d23\u4eba",prop:"owner",minWidth:"100"},{label:"\u72b6\u6001",prop:"status",width:"100"},{label:"\u6392\u5e8f",prop:"sort",width:"100"},{label:"\u521b\u5efa\u65f6\u95f4",prop:"create_datetime",minWidth:"180"}]}}}H.list=a=>e({url:"/api/system/dept/",params:a}),H.add=e=>a({url:"/api/system/dept/",params:e}),H.edit=e=>l({url:"/api/system/dept/",params:e}),H.del=e=>t({url:"/api/system/dept/",params:e}),H.setStatus=e=>a({url:"/api/system/dept/set_status/",params:e}),H.export=(e,a)=>s({url:"/api/system/dept/export_data/",queryParams:e,params:a}),H.import=e=>o({url:"/api/system/dept/import_data/",params:e}),H.downloadTemplate=e=>r({url:"/api/system/dept/download_template/",params:e});const P={__name:"moduleSave",emits:["refreshData","closed"],setup(e,{expose:a,emit:l}){const t=l;let s=c(I().crudOptions),o=c("add");const r={add:"\u65b0\u589e",edit:"\u7f16\u8f91",detail:"\u67e5\u770b"};let n=c(!1),V=c(!1),C=c(null),q=c({parent:"",name:"",sort:1,email:"",owner:"",phone:"",status:!0}),S={sort:[{required:!0,message:"\u8bf7\u8f93\u5165\u6392\u5e8f",trigger:"change"}],name:[{required:!0,message:"\u8bf7\u8f93\u5165\u90e8\u95e8\u540d\u79f0"}],key:[{required:!0,message:"\u8bf7\u8f93\u5165\u6807\u8bc6\u5b57\u7b26",trigger:"blur"}]};const O=c([]);return h(()=>{(async()=>{s.value.request.list({page:1,limit:999,status:1}).then(e=>{2e3===e.code&&(O.value=u.toArrayTree(e.data.data,{parentKey:"parent",strict:!1}))})})()}),a({handleOpen:(e=null,a="add")=>{o.value=a,n.value=!0,e&&(q.value=d(e))}}),(e,a)=>{const l=f("el-tree-select"),d=f("el-form-item"),u=f("el-input"),c=f("el-input-number"),h=f("el-switch"),U=f("el-form"),B=f("el-button");return b(),v(i,{title:r[g(o)],modelValue:g(n),"onUpdate:modelValue":a[8]||(a[8]=e=>x(n)?n.value=e:n=e),width:"500px","destroy-on-close":"",onClosed:a[9]||(a[9]=e=>t("closed"))},{footer:y(()=>[w(B,{onClick:a[6]||(a[6]=e=>x(n)?n.value=!1:n=!1)},{default:y(()=>[...a[10]||(a[10]=[j("\u53d6 \u6d88",-1)])]),_:1}),"detail"!=g(o)?(b(),v(B,{key:0,type:"primary",loading:g(V),onClick:a[7]||(a[7]=e=>{C.value.validate(async e=>{if(e){V.value=!0;let e=s.value.request.add;"edit"==o.value&&(e=s.value.request.edit);const a=await e(q.value);V.value=!1,2e3==a.code?(t("refreshData"),n.value=!1,p.success("\u64cd\u4f5c\u6210\u529f")):m.alert(a.msg,"\u63d0\u793a",{type:"error"})}})})},{default:y(()=>[...a[11]||(a[11]=[j("\u4fdd \u5b58",-1)])]),_:1},8,["loading"])):k("",!0)]),default:y(()=>[w(U,{model:g(q),rules:g(S),disabled:"detail"==g(o),ref_key:"dialogForm",ref:C,"label-width":"auto"},{default:y(()=>[w(d,{label:"\u4e0a\u7ea7\u90e8\u95e8",prop:"parent"},{default:y(()=>[w(l,{modelValue:g(q).parent,"onUpdate:modelValue":a[0]||(a[0]=e=>g(q).parent=e),"node-key":"id",data:O.value,"default-expand-all":"","check-strictly":"",filterable:"",clearable:"","render-after-expand":!1,props:{label:"name",value:"id"},style:{width:"100%"},placeholder:"\u8bf7\u9009\u62e9/\u4e3a\u7a7a\u5219\u4e3a\u9876\u7ea7"},{default:y(({data:{name:e,sort:a}})=>[j(_(e),1)]),_:1},8,["modelValue","data"])]),_:1}),w(d,{label:"\u90e8\u95e8\u540d\u79f0",prop:"name"},{default:y(()=>[w(u,{modelValue:g(q).name,"onUpdate:modelValue":a[1]||(a[1]=e=>g(q).name=e),placeholder:"\u8bf7\u8f93\u5165\u90e8\u95e8\u540d\u79f0",clearable:""},null,8,["modelValue"])]),_:1}),w(d,{label:"\u6807\u8bc6\u5b57\u7b26",prop:"key"},{default:y(()=>[w(u,{modelValue:g(q).key,"onUpdate:modelValue":a[2]||(a[2]=e=>g(q).key=e),placeholder:"\u8bf7\u8f93\u5165\u6807\u8bc6\u5b57\u7b26",clearable:""},null,8,["modelValue"])]),_:1}),w(d,{label:"\u8d1f\u8d23\u4eba",prop:"owner"},{default:y(()=>[w(u,{modelValue:g(q).owner,"onUpdate:modelValue":a[3]||(a[3]=e=>g(q).owner=e),placeholder:"\u8bf7\u8f93\u5165\u8d1f\u8d23\u4eba",clearable:""},null,8,["modelValue"])]),_:1}),w(d,{label:"\u6392\u5e8f",prop:"sort"},{default:y(()=>[w(c,{modelValue:g(q).sort,"onUpdate:modelValue":a[4]||(a[4]=e=>g(q).sort=e),"controls-position":"right",min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),w(d,{label:"\u72b6\u6001",prop:"status"},{default:y(()=>[w(h,{modelValue:g(q).status,"onUpdate:modelValue":a[5]||(a[5]=e=>g(q).status=e),"inline-prompt":"","active-text":"\u542f\u7528","inactive-text":"\u7981\u7528"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules","disabled"])]),_:1},8,["title","modelValue"])}}},R={style:{display:"flex","justify-content":"space-between","align-items":"center"}},W=["onClick"],K=["onClick"],A=V({name:"deptManage"}),F=Object.assign(A,{setup(e){const a=M(),l=n();let t=c(I().crudOptions);const s=e=>l.hasButtonPermission(a.name,e),o=c(!1),r=c(!1),i=c({}),d=c(null),u=c(null),_=c(null);let x=c([]);function V(e){x.value=e}let H=C(()=>({...t.value.table,...t.value.pagination,apiObj:t.value.request.list,apiImportObj:t.value.request.import,apiExportObj:t.value.request.export,apiTemplateObj:t.value.request.dltemplate,params:i.value,column:t.value.columns,hideExport:!s("Export"),hideImport:!s("Import")}));const A=()=>{o.value=!o.value,window.dispatchEvent(new Event("resize"))},F=()=>{r.value=!0,D(()=>{_.value.handleOpen(null,"add")})};function G(){m.confirm(`\u786e\u5b9a\u5220\u9664\u9009\u4e2d\u7684 ${x.value.length} \u9879\u5417\uff1f`,"\u63d0\u793a",{confirmButtonText:"\u786e\u5b9a",cancelButtonText:"\u53d6\u6d88",type:"warning"}).then(()=>{let e=x.value.map(e=>e.id);t.value.request.del({id:e}).then(e=>{2e3==e.code?(N(),p.success("\u64cd\u4f5c\u6210\u529f")):p.warning(e.msg)})}).catch(()=>{})}const L=(e,a)=>{switch(a){case"edit":r.value=!0,D(()=>{_.value.handleOpen(e,"edit")});break;case"delete":m.confirm("\u60a8\u786e\u5b9a\u8981\u5220\u9664\u9009\u4e2d\u7684\u6570\u636e\u5417\uff1f","\u8b66\u544a",{closeOnClickModal:!1,type:"warning"}).then(()=>{t.value.request.del({id:e.id}).then(e=>{2e3==e.code?(p.success(e.msg),N()):p.warning(e.msg)})}).catch(()=>{});break;case"reset":i.value={},N()}},N=()=>{u.value.reload(i.value)},Q=()=>{u.value.getData()};return h(()=>{}),q(()=>{}),(e,a)=>{const l=f("el-input"),n=f("el-form-item"),c=f("el-card"),h=f("el-button"),C=f("el-switch"),q=f("full-screen"),D=f("el-icon"),M=f("el-tooltip"),I=f("el-table-column"),X=f("ly-table"),$=S("auth");return b(),O("div",{class:T([{"ly-is-full":o.value},"lycontainer"])},[g(t).searchBar.showSearchBar?(b(),v(c,{key:0,class:"tableSelect",ref_key:"tableSelect",ref:d,shadow:"hover"},{default:y(()=>[w(z,{model:i.value,onSearch:N,onReset:a[1]||(a[1]=e=>L("","reset"))},{default:y(()=>[w(n,{label:"\u90e8\u95e8\u540d\u79f0"},{default:y(()=>[w(l,{modelValue:i.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value.name=e),modelModifiers:{trim:!0},maxlength:"60",clearable:"",style:{width:"160px"},placeholder:"\u90e8\u95e8\u540d\u79f0"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},512)):k("",!0),w(c,{class:"lytable",shadow:"hover"},{default:y(()=>[w(X,U(g(H),{ref_key:"tableref",ref:u,onSelectionChange:V}),{topbar:y(()=>[B((b(),v(h,{type:"primary",icon:"plus",onClick:F},{default:y(()=>[...a[3]||(a[3]=[j("\u65b0\u589e",-1)])]),_:1})),[[$,"Create"]]),B(w(h,{type:"danger",plain:"",icon:"delete",disabled:0==g(x).length,title:"\u6279\u91cf\u5220\u9664",onClick:G},null,8,["disabled"]),[[$,"Delete"]])]),status:y(e=>[w(C,{modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-color":"#13ce66","inactive-color":"#ff4949",onChange:a=>(e=>{let a=e.status;e.status=!e.status,m.confirm("\u786e\u5b9a\u4fee\u6539\u72b6\u6001\u5417\uff1f","\u63d0\u9192",{closeOnClickModal:!1,type:"warning"}).then(()=>{t.value.request.setStatus({id:e.id}).then(l=>{2e3==l.code?(e.status=!!a,p.success(l.msg),Q()):p.warning(l.msg)})})})(e.row),disabled:!s("SetStatus")},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"])]),default:y(()=>[w(I,{label:"\u64cd\u4f5c",fixed:g(t).rowHandle.fixed,width:g(t).rowHandle.width},{header:y(()=>[E("div",R,[a[4]||(a[4]=E("div",null,"\u64cd\u4f5c",-1)),E("div",{onClick:A},[w(M,{content:"\u5168\u5c4f",placement:"bottom"},{default:y(()=>[w(D,{style:{cursor:"pointer"}},{default:y(()=>[w(q)]),_:1})]),_:1})])])]),default:y(e=>[B((b(),O("span",{class:"table-operate-btn",onClick:a=>L(e.row,"edit")},[...a[5]||(a[5]=[j("\u7f16\u8f91",-1)])],8,W)),[[$,"Update"]]),B((b(),O("span",{class:"table-operate-btn delete",onClick:a=>L(e.row,"delete")},[...a[6]||(a[6]=[j("\u5220\u9664",-1)])],8,K)),[[$,"Delete"]])]),_:1},8,["fixed","width"])]),_:1},16)]),_:1}),r.value?(b(),v(P,{key:1,ref_key:"saveDialogRef",ref:_,onRefreshData:Q,onClosed:a[2]||(a[2]=e=>r.value=!1)},null,512)):k("",!0)],2)}}});export{F as default};
