import{_ as e,A as l,l as a,j as t}from"./index.CmK67jVc.js";import{R as u}from"./wangEditor.CnbmLdp2.js";import{u as o}from"./@vueuse.CxA-JytG.js";import{P as s}from"./Pagination.BCaSAlhm.js";import{a as d}from"./element-plus.BU70F6Fx.js";import{r as i,j as n,k as r,b as p,n as v,al as m,ar as c,K as g,o as f,L as b,M as h,c as y,F as _,a as V,T as w,E as j,R as k,e as x,u as C,O,Q as S}from"./@vue.CTPu-uAZ.js";const T={class:"ly-table-select__header"},U=["textContent"],E={class:"ly-table-select__page"},M=e({__name:"lyTableSelect",props:{modelValue:null,successCode:{type:Number,default:2e3},apiObj:{type:Function,default:null},params:{type:Object,default:()=>({})},placeholder:{type:String,default:"\u8bf7\u9009\u62e9"},size:{type:String,default:"default"},clearable:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},filterable:{type:Boolean,default:!1},collapseTags:{type:Boolean,default:!1},collapseTagsTooltip:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},tableWidth:{type:Number,default:0},mode:{type:String,default:"popover"},props:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{expose:l,emit:a}){const t=e,u=a,x=i(!1),C=i(t.multiple?[]:null),O=i([]),S=i({page:1,limit:10}),M=i({page:1,limit:10,total:0}),R=i({}),z=i(null),B=i(null),F=i({label:"label",value:"value",page:"page",pageSize:"limit"});Object.assign(F.value,t.props);const{width:I}=o(),L=n(()=>I.value<768);r(()=>t.modelValue,e=>{C.value=e,$()},{deep:!0}),p(()=>{C.value=t.modelValue,$()});const q=e=>{S.value.page=e.page,S.value.limit=e.limit,P()},A=()=>{t.multiple&&void 0===C.value&&(C.value=[])},N=e=>{e?(S.value.page=1,R.value={},P()):$()},P=async()=>{x.value=!0;const e={[F.value.page]:S.value.page,[F.value.pageSize]:S.value.limit};Object.assign(e,t.params,R.value);try{const l=await t.apiObj(e);x.value=!1,l.code===t.successCode?(O.value=l.data.data,M.value.page=l.data.page,M.value.limit=l.data.limit,M.value.total=l.data.total):d.warning(l.msg),v(()=>{if(t.multiple)A(),C.value.forEach(e=>{const l=O.value.filter(l=>l[F.value.value]===e[F.value.value]);l.length>0&&B.value.toggleRowSelection(l[0],!0)});else{const e=O.value.filter(e=>e[F.value.value]===C.value[F.value.value]);B.value.setCurrentRow(e[0])}B.value.setScrollTop(0)})}catch(l){x.value=!1,d.error("\u8bf7\u6c42\u5931\u8d25")}},W=()=>{S.value.page=1,P()},$=()=>{v(()=>{z.value&&(t.multiple?z.value.states.selected.forEach(e=>{e.currentLabel=e.value[F.value.label]}):z.value.selectedLabel=C.value?.[F.value.label]||"")})},D=(e,l)=>{A();if(e.length&&-1!==e.indexOf(l))C.value.push(l);else{const e=C.value.findIndex(e=>e[F.value.value]==l[F.value.value]);-1!==e&&C.value.splice(e,1)}$(),u("update:modelValue",C.value),u("change",C.value)},K=e=>{A();e.length>0?e.forEach(e=>{C.value.find(l=>l[F.value.value]==e[F.value.value])||C.value.push(e)}):O.value.forEach(e=>{if(C.value.find(l=>l[F.value.value]==e[F.value.value])){const l=C.value.findIndex(l=>l[F.value.value]==e[F.value.value]);C.value.splice(l,1)}}),$(),u("update:modelValue",C.value),u("change",C.value)},Q=e=>{t.multiple||(C.value=e,z.value.blur(),$(),u("update:modelValue",C.value),u("change",C.value))},G=e=>{const l=J(e[F.value.value]);B.value.toggleRowSelection(l,!1),u("update:modelValue",C.value)},H=()=>{u("update:modelValue",C.value)},J=e=>O.value.find(l=>l[F.value.value]===e),X=()=>{P()};return l({blur:()=>{z.value.blur()},focus:()=>{z.value.focus()}}),(l,a)=>{const t=m("el-table-column"),u=m("el-table"),o=m("el-select"),d=c("loading");return f(),g(o,{ref_key:"selectRef",ref:z,modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=e=>C.value=e),size:e.size,clearable:e.clearable,multiple:e.multiple,"collapse-tags":e.collapseTags,"collapse-tags-tooltip":e.collapseTagsTooltip,filterable:e.filterable,placeholder:e.placeholder,disabled:e.disabled,"filter-method":X,onRemoveTag:G,onVisibleChange:N,onClear:H,class:"table-select"},{empty:b(()=>[h((f(),y("div",{class:"ly-table-select__table",style:_({width:e.tableWidth>0?e.tableWidth+"px":"100%"})},[V("div",T,[j(l.$slots,"header",{form:R.value,submit:W},void 0,!0)]),w(u,{ref_key:"tableRef",ref:B,border:"",data:O.value,height:L.value?"auto":350,"highlight-current-row":!e.multiple,onRowClick:Q,onSelect:D,onSelectAll:K,style:{width:"100%"}},{default:b(()=>[e.multiple?(f(),g(t,{key:0,type:"selection",width:"45"})):(f(),g(t,{key:1,type:"index",width:"45"},{default:b(e=>{return[V("span",{textContent:k((l=e.$index,(M.value.page-1)*M.value.limit+l+1))},null,8,U)];var l}),_:1})),j(l.$slots,"default",{},void 0,!0)]),_:3},8,["data","height","highlight-current-row"]),V("div",E,[w(s,{small:!0,"child-msg":M.value,onCallFather:q},null,8,["child-msg"])])],4)),[[d,x.value]])]),_:3},8,["modelValue","size","clearable","multiple","collapse-tags","collapse-tags-tooltip","filterable","placeholder","disabled"])}}},[["__scopeId","data-v-0f7e3106"]]),R=e({__name:"addModuleNotice",emits:["refreshData","closed"],setup(e,{expose:o,emit:s}){const n=s,r=i(!1),v=i(!1);i("");const c=i(null);let h=i(!1),_=i("add");const V={add:"\u65b0\u589e",edit:"\u7f16\u8f91",detail:"\u8be6\u60c5"},j=i({title:"",content:"",target_type:0,users:[]}),k=i({title:[{required:!0,message:"\u8bf7\u586b\u5199\u516c\u544a\u6807\u9898",trigger:"blur"}],content:[{required:!0,message:"\u8bf7\u586b\u5199\u516c\u544a\u5185\u5bb9",trigger:"blur"}]}),T=i({label:"username",value:"id"}),U=e=>{e.stopImmediatePropagation()},E=()=>{r.value=!1,v.value=!1,j.value={msg_title:"",to_path:"",msg_content:"",target_type:1,target_user:[],status:!0}};const R=()=>{c.value.validate(e=>{if(e){v.value=!0;const e={...j.value};e.users.length>0&&(e.users=e.users.map(e=>e.id));(e.id?l.messagesMessagenoticeEdit:l.messagesMessagenoticeAdd)(e).then(e=>{v.value=!1,2e3==e.code?(d.success(e.msg),n("refreshData"),E()):d.warning(e.msg)})}})};return p(()=>{window.addEventListener("focusin",U,!0)}),x(()=>{window.removeEventListener("focusin",U)}),o({addModuleFn:(e,l="add")=>{_.value=l,r.value=!0,e&&(j.value=t(e))},readMsg:function(){l.readOwnMessage({id:j.value.id}).then(e=>{2e3==e.code||d.warning(e.msg)})},isUserOwnMsg:h}),(e,t)=>{const o=m("el-input"),s=m("el-form-item"),d=m("el-radio"),i=m("el-radio-group"),p=m("el-button"),x=m("el-form"),U=m("el-table-column");return f(),y("div",null,[w(a,{modelValue:r.value,"onUpdate:modelValue":t[4]||(t[4]=e=>r.value=e),title:V[C(_)],width:"50%",onClosed:t[5]||(t[5]=e=>n("closed"))},{footer:b(()=>[w(p,{onClick:E,loading:v.value},{default:b(()=>[...t[9]||(t[9]=[S("\u53d6\u6d88",-1)])]),_:1},8,["loading"]),"detail"!=C(_)?(f(),g(p,{key:0,type:"primary",onClick:R,loading:v.value},{default:b(()=>[...t[10]||(t[10]=[S("\u786e\u5b9a",-1)])]),_:1},8,["loading"])):O("",!0)]),default:b(()=>[w(x,{inline:!1,model:j.value,rules:k.value,ref_key:"rulesForm",ref:c,"label-position":"right","label-width":"auto",disabled:"detail"==C(_)},{default:b(()=>[w(s,{label:"\u6d88\u606f\u6807\u9898",prop:"title"},{default:b(()=>[w(o,{type:"text",modelValue:j.value.title,"onUpdate:modelValue":t[0]||(t[0]=e=>j.value.title=e),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),C(h)?O("",!0):(f(),g(s,{key:0,label:"\u76ee\u6807\u7c7b\u578b",prop:"target_type"},{default:b(()=>[w(i,{modelValue:j.value.target_type,"onUpdate:modelValue":t[1]||(t[1]=e=>j.value.target_type=e)},{default:b(()=>[w(d,{value:0,border:""},{default:b(()=>[...t[6]||(t[6]=[S("\u5e73\u53f0\u516c\u544a",-1)])]),_:1}),w(d,{value:1,border:""},{default:b(()=>[...t[7]||(t[7]=[S("\u6309\u7528\u6237",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})),1!=j.value.target_type||C(h)?O("",!0):(f(),g(s,{key:1,label:"\u53d1\u9001\u5bf9\u8c61",prop:"users",class:"is-required"},{default:b(()=>[w(M,{modelValue:j.value.users,"onUpdate:modelValue":t[2]||(t[2]=e=>j.value.users=e),apiObj:C(l).apiSystemUser,multiple:"",clearable:"","collapse-tags":"","collapse-tags-tooltip":"",props:T.value},{header:b(({form:e,submit:l})=>[w(x,{inline:!0,model:e},{default:b(()=>[w(s,null,{default:b(()=>[w(o,{type:"text",modelValue:e.username,"onUpdate:modelValue":l=>e.username=l,placeholder:"\u8bf7\u8f93\u5165\u7528\u6237\u540d"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),w(s,null,{default:b(()=>[w(p,{type:"primary",onClick:l},{default:b(()=>[...t[8]||(t[8]=[S("\u67e5\u8be2",-1)])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),default:b(()=>[w(U,{prop:"username",label:"\u7528\u6237\u540d","min-width":"100","show-overflow-tooltip":""}),w(U,{prop:"nickname",label:"\u6635\u79f0","min-width":"100"}),w(U,{prop:"mobile",label:"\u624b\u673a\u53f7","min-width":"150"})]),_:1},8,["modelValue","apiObj","props"])]),_:1})),w(s,{label:"\u6d88\u606f\u5185\u5bb9",prop:"content"},{default:b(()=>[w(u,{modelValue:j.value.content,"onUpdate:modelValue":t[3]||(t[3]=e=>j.value.content=e),readOnly:"detail"==C(_)},null,8,["modelValue","readOnly"])]),_:1})]),_:1},8,["model","rules","disabled"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-2d674783"]]);export{R as a};
